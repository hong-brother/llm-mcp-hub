# CLI OAuth 토큰 생성 방법

이 문서는 Claude CLI와 Gemini CLI에서 OAuth 토큰을 생성하고 관리하는 방법을 설명합니다.

> **중요**: API Key 방식은 사용량 기반 과금이 발생하므로 사용하지 않습니다. 기존 구독(Claude Pro/Max, Gemini Pro/Ultra)을 활용하기 위해 OAuth 인증만 사용합니다.

---

## Claude CLI

### 인증 방법

**방법 1: 대화형 로그인**
```bash
# Claude CLI 실행
claude

# 내부에서 로그인 명령 실행
/login
```

**방법 2: 토큰 직접 생성**
```bash
# OAuth 토큰 생성
claude setup-token
```

### 토큰 저장 위치

| OS | 저장 위치 |
|----|-----------|
| macOS | macOS Keychain (암호화) |
| Linux | `~/.claude/.credentials.json` |
| Windows | `%APPDATA%\Claude\credentials.json` |

### 토큰 확인 방법

**Linux:**
```bash
cat ~/.claude/.credentials.json
```

**macOS:**
```bash
# Keychain에서 확인
security find-generic-password -s "Claude" -w
```

### 환경변수 설정

```bash
# 생성된 토큰을 환경변수로 설정
export CLAUDE_CODE_OAUTH_TOKEN=<생성된-토큰>
```

### Docker 환경 설정

**방법 1: 환경변수 사용**
```bash
docker run -e CLAUDE_CODE_OAUTH_TOKEN=<토큰> llm-mcp-hub
```

**방법 2: credentials 파일 마운트**
```bash
# 호스트에서 먼저 인증 수행
claude /login

# Docker 컨테이너에 마운트
docker run -v ~/.claude:/root/.claude llm-mcp-hub
```

---

## Gemini CLI

### 인증 방법

Gemini CLI는 별도의 토큰 생성 명령어가 없습니다. 대화형으로만 인증 가능합니다.

```bash
# Gemini CLI 실행
gemini

# 인증 방식 선택 메뉴 표시:
# 1. Login with Google  ← 구독자용 (Pro/Ultra) 선택
# 2. Use Gemini API key
# 3. Vertex AI
```

브라우저가 열리고 Google 계정으로 로그인하면 토큰이 자동 저장됩니다.

### 토큰 저장 위치

| OS | 저장 위치 |
|----|-----------|
| macOS | macOS Keychain 또는 `~/.gemini/oauth_creds.json` |
| Linux | `~/.gemini/oauth_creds.json` |
| Windows | Windows Credential Manager |

### 토큰 확인 방법

```bash
# OAuth 토큰 파일 확인
cat ~/.gemini/oauth_creds.json

# 설정 파일 확인
cat ~/.gemini/settings.json
```

### 환경변수 설정

> **주의**: Gemini CLI는 OAuth 토큰용 환경변수를 지원하지 않습니다. 파일 마운트 방식만 사용 가능합니다.

```bash
# API Key 방식 (비권장 - 과금 발생)
export GEMINI_API_KEY=<API-KEY>
```

### Headless 환경 (서버) 인증

브라우저가 없는 서버 환경에서는 수동 URL 인증 방식을 사용합니다:

```bash
# Gemini CLI 실행 시 URL이 출력됨
gemini

# 출력된 URL을 로컬 브라우저에서 열어 인증
# 인증 완료 후 표시되는 코드를 터미널에 입력
```

### Docker 환경 설정

```bash
# 호스트에서 먼저 인증 수행
gemini  # "Login with Google" 선택 후 인증

# Docker 컨테이너에 credentials 마운트
docker run -v ~/.gemini:/root/.gemini llm-mcp-hub
```

---

## 비교 요약

| 항목 | Claude CLI | Gemini CLI |
|------|------------|------------|
| 토큰 생성 명령 | `claude setup-token` | 없음 (대화형만) |
| 대화형 로그인 | `/login` | `gemini` 실행 시 선택 |
| OAuth 환경변수 | `CLAUDE_CODE_OAUTH_TOKEN` | 지원 안함 |
| 토큰 파일 위치 | `~/.claude/.credentials.json` | `~/.gemini/oauth_creds.json` |
| Docker 사용 시 | 환경변수 또는 파일 마운트 | 파일 마운트만 가능 |

---

## 토큰 갱신 및 유지 관리

| 항목 | Claude CLI | Gemini CLI |
|------|------------|------------|
| Access Token 만료 | 자동 refresh | 자동 refresh |
| Refresh Token 만료 | 수동 재인증 필요 | 수동 재인증 필요 |
| 권장 재인증 주기 | 30일 | 30일 |

> **Docker 환경 주의사항**: 컨테이너 내에서는 토큰 만료 시 자동 재인증이 불가합니다. 토큰 만료 전에 호스트에서 재인증 후 컨테이너를 재시작해야 합니다.

---

## 참고 자료

- [Claude Code - Identity and Access Management](https://code.claude.com/docs/en/iam)
- [Claude Code Cheat Sheet](https://shipyard.build/blog/claude-code-cheat-sheet/)
- [Gemini CLI Authentication Setup](https://google-gemini.github.io/gemini-cli/docs/get-started/authentication.html)
- [Gemini CLI - GitHub](https://github.com/google-gemini/gemini-cli)
